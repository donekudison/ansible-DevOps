---
#Install Packages
- hosts: all
  vars:
  root_db_password: Passwd1234T #Replace this with your root mysql passwd
  sudo: yes

 tasks:
  
 - name: Download MYSQL Community Repo
     get_url:
         dest: /tmp
         url: http://repo.mysql.com/mysql-community-release-el7-7.noarch.rpm

 - name: Install MYSQL Community Repo
   command: /usr/bin/rpm -ivh /tmp/mysql-community-release-el7-7.noarch.rpm

 - name: Install MYSQL Server
   yum: name=mysql-server state=present

 - name: Install MYSQL-python, this is require to remove anonymous user
   yum: name=MYSQL-python state=present

 - name: Start MYSQL Server and enable it
   service: name=mysqld sstate=started enabled=yes

 - name: Remove Test database if it exist.
   mysql_db: name=test state=absent

 - name: Remove all anonymous user Accounts
   mysql_user: name= '' host_all=yes state=absent

 - name: Change root password
   mysql_user: name=root host={{item}} password={{root_db_password}}
   with_items:
     - "{{ansible_hostname}}"
     - 127.0.0.1
     - ::1
     - localhost

  handlers:
   - name: Restart mysql
    service: name=mysqld state=restarted

